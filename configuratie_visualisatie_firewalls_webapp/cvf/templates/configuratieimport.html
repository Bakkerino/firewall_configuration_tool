{% extends "base.html" %}
{% block inhoud %}
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>

<h1>Configuratieimport</h1>

<form action="/configuratieimport" method="POST" enctype="multipart/form-data">

    <div class="input-group">
        <div class="custom-file">
          <input type="file" class="custom-file-input" name="cfgbestand" id="cfgbestand" aria-describedby="inputGroupFileAddon04" oninput="filesize(this);">
          <label class="custom-file-label" for="cfgbestand">{% if bestandsnaam%}{{bestandsnaam}}{% else %}Kies een bestand...{% endif %}</label>
        </div>
        <div class="input-group-append">
          <button type="submit" class="btn btn-outline-secondary" id="btn">Importeren
        </button>
        </div>
      </div>
</form>


<legend class="border-bottom mb-4"></legend>
<div class="shadow-sm p-3 mb-5 bg-white rounded">


        <ul class="nav nav-tabs" id="myTab" role="tablist">
  {% if cfgbestand and cfgjson %}
          <li class="nav-item">
            <a class="nav-link" id="bestand-tab" data-toggle="tab" href="#bestand" role="tab" aria-controls="bestand" aria-selected="true">(debug)Bestand</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="verwerkt-tab" data-toggle="tab" href="#verwerkt" role="tab" aria-controls="verwerkt" aria-selected="false">(debug)Verwerkt</a>
          </li>
  {% endif %}
          <li class="nav-item">
            <a class="nav-link" id="instellingen-tab" data-toggle="tab" href="#instellingen" role="tab" aria-controls="instellingen" aria-selected="false">Instellingen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" id="overzicht-tab" data-toggle="tab" href="#overzicht" role="tab" aria-controls="overzicht" aria-selected="false">Overzicht</a>
          </li>
        </ul>

        <div class="tab-content" id="myTabContent">
  {% if cfgbestand and cfgjson %}
          <div class="tab-pane fade" id="bestand" role="tabpanel" aria-labelledby="bestand-tab">
          <div class="form-group">
              <textarea class="form-control" id="result" rows="30" cols="50">{{ cfgbestand }}</textarea>
          </div>
          </div>

          <div class="tab-pane fade" id="verwerkt" role="tabpanel" aria-labelledby="verwerkt-tab">
          <div class="form-group">
            <textarea class="form-control" id="result" rows="30" cols="50">{{ cfgjson }}</textarea>
          </div>
          </div>
  {% endif %}
          <div class="tab-pane fade" id="instellingen" role="tabpanel" aria-labelledby="instellingen-tab" style="width: 100%">
            {{ overviewConfigHTML | safe }}
          </div>
          <div class="tab-pane fade show active" id="overzicht" role="tabpanel" aria-labelledby="overzicht-tab" style="width: 100%">
  {% if cfgJsonObject %}
            <header class="p-3 mb-2 bg-grey rounded border border-secondary" id="overzichtheader" >
              <div class="media">
              <img src="static/icons/fortigate.png" class="align-self-center mr-3" alt="fortigate">
              <div class="media-body" id="mediaoverzicht">
                <h5 class="mt-0"><b>{{ cfgJsonObject['config']['version']['version'].split('-')[0].replace('FGT', 'FortiGate ') }}</b></h5>
                <table id="headertable" class="table table-borderles">
                  <tbody>

                      <tr>
                      <th>Hostname:</th> <td>{{ cfgJsonObject['global']['1']['hostname'] }}</td>
                      <th>Alias:</th> <td>{{ cfgJsonObject['global']['1']['alias'] }}</td>
                    </tr>
                    <tr>
                      <th>Software versie:</th>  <td>{{ cfgJsonObject['config']['version']['version'].split('-')[1] }}</td>
                      <th>Build:</th> <td>{{ cfgJsonObject['config']['version']['build'] }}</td>
                    </tr>

                  </tbody>
                </table>
              </div>
            </div></header>
            <legend class="border-bottom mb-1"></legend>

            <div class="p-3 mb-2 bg-grey rounded border border-danger" id="overzichtrecord">
              {{ overviewImpact | safe }}
            </div>

  {% endif %}

          </div>

        </div>
</div>
<legend class="border-bottom mb-4"></legend>

<script>


  // get and put filesize in cookie
  function filesize(elem){
    document.cookie = `filesize=${elem.files[0].size}`
  }

// Toggle for buttons in configurationtable
  $(document).ready(function() {
	$('[data-toggle="toggle"]').change(function(){
		$(this).parents().next('.hide').toggle();
	});
});

  $('#cfgbestand').on('change',function(){
      //get filename
      var fileName = $(this).val();
      var shortFileName = fileName.replace('C:\\fakepath\\', " ");
      //change label
      $(this).next('.custom-file-label').html(shortFileName);
  })
</script>

{% endblock %}